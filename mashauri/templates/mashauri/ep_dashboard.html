<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>

        <style>
            table {
                width: 100%;
                background-color: #D6EEEE;
            }
            
            table,
            th,
            td {
                border: 1px solid black;
                border-collapse: collapse;
            }
            
            th,
            td {
                padding: 12px;
                text-align: left;
                vertical-align: middle;
            }
        </style>
    </head>

    <body>
        <h1>Welcome to the Dashboard</h1>
        <h2>User Information</h2>
        <p>Username: {{ user.username }}</p>
        <p>First Name: {{ user.first_name }}</p>
        <p>Last Name: {{ user.last_name }}</p>
        <p>Email: {{ user.email }}</p>
        <p>Role: {{ user.role }}</p>
        <p>Date Joined: {{ user.date_joined }}</p>
        <a href="{% url 'dispatch' %}">Dispatch Building</a>

        <h2>Dispatches</h2>
    <table>
        <tr>
            <td></td>
            <td></td>
            <th>
                <small>Filter by MSP:</small>
                <form method="get" action="">
                    <select name="msp_filter" id="msp-filter">
                        <option value="None" selected>None</option>
                        <option value="Egypro">Egypro</option>
                        <option value="Camusat">Camusat</option>
                        <option value="Adrian">Adrian</option>
                        <option value="Kinde">Kinde</option>
                        <option value="Fireside">Fireside</option>
                        <option value="Soliton">Soliton</option>
                    </select>
                </form>
            </th>
            <th>
                <small>Filter by FDP:</small>
                <form method="get" action="">
                    <select name="fdp_filter" id="fdp-filter">
                        <option value="None" selected>None</option>
                        <option value="Fireside">Fireside</option>
                        <option value="Broadcom">Broadcom</option>
                        <option value="Optimax">Optimax</option>
                        <option value="BTN">BTN</option>
                        <option value="Com21">Com21</option>
                    </select>
                </form>
            </th>
        </tr>
        <tr>
            <th>Building Name</th>
            <th>Building ID</th>
            <th>msp</th>
            <th>fdp</th>
            <th>escalation_type</th>
            <th>Comments</th>
            <th>Coordinates</th>
            <th>Client_id</th>
            <th>client_name</th>
            <th>created_at</th>
            <th>sla_timer</th>
            <th>Creator</th>
        </tr>
        {% for dispatch in dispatches %} 
            
        <tr>
            <td>{{ dispatch.building_name }}</td>
            <td>{{ dispatch.building_id }}</td>
            <td>{{ dispatch.msp }}</td>
            <td>{{ dispatch.fdp }}</td>
            <td>{{ dispatch.escalation_type }}</td>
            <td>{{ dispatch.comments }}</td>
            <td>{{ dispatch.coordinates }}</td>
            <td>{{ dispatch.client_id }}</td>
            <td>{{ dispatch.client_name }}</td>
            <td>{{ dispatch.created_at }}</td>
            <td>{{ dispatch.sla_timer }}</td>
            <td>{{ user.role}}</td>
        </tr>
        {% endfor %}
    </table>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Filter on MSP change
            document.getElementById('msp-filter').addEventListener('change', function() {
                var mspValue = this.value;
                filterTable('msp', mspValue);
            });
        
            // Filter on FDP change
            document.getElementById('fdp-filter').addEventListener('change', function() {
                var fdpValue = this.value;
                filterTable('fdp', fdpValue);
            });
        
            // Function to filter the table based on selection
            function filterTable(filterType, value) {
                var rows = document.querySelectorAll('tr');
                rows.forEach(function(row) {
                    var cell = row.querySelector('td:nth-child(' + (['msp', 'fdp'].indexOf(filterType) + 3) + ')');
                    if (cell) {
                        if (value && cell.textContent.trim() !== value) {
                            row.style.display = 'none';
                        } else {
                            row.style.display = '';
                        }
                    }
                });
            }
        });
        </script>
    </body>

</html>